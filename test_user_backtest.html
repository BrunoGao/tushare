<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººç”¨æˆ·å›æµ‹åŠŸèƒ½æµ‹è¯•</title>
    <style>
        :root {
            --primary: #1890ff;
            --success: #52c41a;
            --error: #ff4d4f;
            --bg-primary: #ffffff;
            --bg-secondary: #fafafa;
            --text-primary: #262626;
            --text-secondary: #8c8c8c;
            --border-color: #d9d9d9;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: var(--bg-secondary);
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--bg-primary);
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px;
            font-size: 14px;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: var(--text-primary);
        }
        
        .result {
            margin: 10px 0;
            padding: 12px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .result.success {
            background: rgba(82, 196, 26, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }
        
        .result.error {
            background: rgba(255, 77, 79, 0.1);
            border: 1px solid var(--error);
            color: var(--error);
        }
        
        .result.info {
            background: rgba(24, 144, 255, 0.1);
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 16px 0;
        }
        
        .metric {
            text-align: center;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 4px;
        }
        
        .metric-value {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .metric-label {
            font-size: 12px;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ä¸ªäººç”¨æˆ·æŠ•èµ„ç­–ç•¥å›æµ‹åŠŸèƒ½æµ‹è¯•</h1>
        <p>æµ‹è¯•5005/dashboardä¸­"æˆ‘çš„æŠ•èµ„ç­–ç•¥ å›æµ‹"åŠŸèƒ½çš„ä¸“ä¸šå®ç°</p>
        
        <div class="test-section">
            <h3>ğŸ“Š 1. å›æµ‹APIæµ‹è¯•</h3>
            <p>æµ‹è¯•ç­–ç•¥å›æµ‹APIç«¯ç‚¹çš„è¿é€šæ€§å’Œå“åº”</p>
            <button class="btn" onclick="testBacktestAPI()">æµ‹è¯•å›æµ‹API</button>
            <div id="apiTestResult"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ”„ 2. æ¨¡æ‹Ÿå›æµ‹æµç¨‹</h3>
            <p>æ¨¡æ‹Ÿå®Œæ•´çš„å›æµ‹æµç¨‹ï¼ŒåŒ…æ‹¬æ•°æ®è·å–ã€ä¿¡å·è®¡ç®—å’Œç»“æœåˆ†æ</p>
            <button class="btn" onclick="simulateBacktestFlow()">å¯åŠ¨æ¨¡æ‹Ÿå›æµ‹</button>
            <div id="simulationResult"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“ˆ 3. å›æµ‹ç»“æœå±•ç¤º</h3>
            <p>å±•ç¤ºä¸“ä¸šçš„å›æµ‹ç»“æœç•Œé¢</p>
            <button class="btn" onclick="showDemoResults()">æ˜¾ç¤ºç¤ºä¾‹ç»“æœ</button>
            <div id="resultsDemo"></div>
        </div>
        
        <div class="test-section">
            <h3>âš™ï¸ 4. åŠŸèƒ½ç‰¹æ€§éªŒè¯</h3>
            <p>éªŒè¯å…³é”®åŠŸèƒ½ç‰¹æ€§çš„å®ç°</p>
            <div>
                <button class="btn" onclick="testRiskManagement()">é£é™©ç®¡ç†</button>
                <button class="btn" onclick="testProgressTracking()">è¿›åº¦è¿½è¸ª</button>
                <button class="btn" onclick="testReportExport()">æŠ¥å‘Šå¯¼å‡º</button>
            </div>
            <div id="featureTestResults"></div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿç”¨æˆ·ç­–ç•¥æ•°æ®
        const testStrategy = {
            id: 'demo1',
            name: 'åŒå‡çº¿äº¤å‰ç­–ç•¥',
            type: 'æŠ€æœ¯åˆ†æ',
            description: 'åŸºäº5æ—¥å’Œ20æ—¥ç§»åŠ¨å¹³å‡çº¿äº¤å‰çš„ç­–ç•¥'
        };
        
        // 1. æµ‹è¯•å›æµ‹API
        async function testBacktestAPI() {
            const resultDiv = document.getElementById('apiTestResult');
            resultDiv.innerHTML = '<div class="result info">æ­£åœ¨æµ‹è¯•APIè¿é€šæ€§...</div>';
            
            try {
                // æµ‹è¯•APIç«¯ç‚¹
                const response = await fetch('/api/strategies/demo1/backtest', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        stock_code: '000001',
                        start_date: '2023-08-06',
                        end_date: '2024-08-06', 
                        initial_capital: 100000,
                        commission: 0.0003,
                        risk_management: {
                            stop_loss: 0.05,
                            take_profit: 0.10,
                            max_position_size: 0.20
                        }
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="result success">âœ… APIæµ‹è¯•æˆåŠŸ</div>
                        <div class="result info">å“åº”: ${JSON.stringify(result, null, 2)}</div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result error">âŒ APIæµ‹è¯•å¤±è´¥</div>
                        <div class="result error">é”™è¯¯: ${result.error || 'Unknown error'}</div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">âŒ ç½‘ç»œé”™è¯¯</div>
                    <div class="result error">é”™è¯¯: ${error.message}</div>
                `;
            }
        }
        
        // 2. æ¨¡æ‹Ÿå›æµ‹æµç¨‹
        function simulateBacktestFlow() {
            const resultDiv = document.getElementById('simulationResult');
            resultDiv.innerHTML = '<div class="result info">å¼€å§‹æ¨¡æ‹Ÿå›æµ‹æµç¨‹...</div>';
            
            const steps = [
                { progress: 0, status: 'åˆå§‹åŒ–å›æµ‹å‚æ•°...' },
                { progress: 15, status: 'è·å–å†å²æ•°æ®...' },
                { progress: 30, status: 'è®¡ç®—æŠ€æœ¯æŒ‡æ ‡...' },
                { progress: 50, status: 'ç”Ÿæˆäº¤æ˜“ä¿¡å·...' },
                { progress: 70, status: 'æ‰§è¡Œå›æµ‹äº¤æ˜“...' },
                { progress: 85, status: 'è®¡ç®—é£é™©æŒ‡æ ‡...' },
                { progress: 100, status: 'ç”Ÿæˆå›æµ‹æŠ¥å‘Š...' }
            ];
            
            let currentStep = 0;
            
            const interval = setInterval(() => {
                if (currentStep < steps.length) {
                    const step = steps[currentStep];
                    resultDiv.innerHTML = `
                        <div class="result info">è¿›åº¦: ${step.progress}% - ${step.status}</div>
                        <div style="width: 100%; height: 20px; background: #f0f0f0; border-radius: 10px; overflow: hidden;">
                            <div style="height: 100%; background: var(--primary); width: ${step.progress}%; transition: width 0.3s;"></div>
                        </div>
                    `;
                    
                    if (step.progress === 100) {
                        clearInterval(interval);
                        setTimeout(() => {
                            resultDiv.innerHTML += '<div class="result success">âœ… å›æµ‹æ¨¡æ‹Ÿå®Œæˆï¼</div>';
                        }, 500);
                    }
                    
                    currentStep++;
                } else {
                    clearInterval(interval);
                }
            }, 800);
        }
        
        // 3. æ˜¾ç¤ºç¤ºä¾‹å›æµ‹ç»“æœ
        function showDemoResults() {
            const resultDiv = document.getElementById('resultsDemo');
            
            // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
            const mockResults = {
                totalReturn: 15.8,
                annualReturn: 18.2,
                maxDrawdown: 8.5,
                sharpeRatio: 1.25,
                winRate: 67.3,
                totalTrades: 24,
                period: '2023-08-06 ~ 2024-08-06',
                stockCode: '000001'
            };
            
            resultDiv.innerHTML = `
                <div class="result success">âœ… å›æµ‹ç»“æœå±•ç¤º</div>
                <div class="metric-grid">
                    <div class="metric">
                        <div class="metric-value" style="color: var(--success)">+${mockResults.totalReturn}%</div>
                        <div class="metric-label">æ€»æ”¶ç›Šç‡</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="color: var(--success)">+${mockResults.annualReturn}%</div>
                        <div class="metric-label">å¹´åŒ–æ”¶ç›Šç‡</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="color: var(--error)">${mockResults.maxDrawdown}%</div>
                        <div class="metric-label">æœ€å¤§å›æ’¤</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${mockResults.sharpeRatio}</div>
                        <div class="metric-label">å¤æ™®æ¯”ç‡</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${mockResults.winRate}%</div>
                        <div class="metric-label">èƒœç‡</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${mockResults.totalTrades}</div>
                        <div class="metric-label">äº¤æ˜“æ¬¡æ•°</div>
                    </div>
                </div>
                <div class="result info">
                    å›æµ‹æœŸé—´: ${mockResults.period}<br>
                    è‚¡ç¥¨ä»£ç : ${mockResults.stockCode}<br>
                    ç­–ç•¥: ${testStrategy.name}
                </div>
            `;
        }
        
        // 4. æµ‹è¯•åŠŸèƒ½ç‰¹æ€§
        function testRiskManagement() {
            const resultDiv = document.getElementById('featureTestResults');
            resultDiv.innerHTML = `
                <div class="result success">âœ… é£é™©ç®¡ç†åŠŸèƒ½éªŒè¯</div>
                <div class="result info">
                â€¢ æ­¢æŸè®¾ç½®: 5% âœ“<br>
                â€¢ æ­¢ç›ˆè®¾ç½®: 10% âœ“<br>
                â€¢ æœ€å¤§ä»“ä½: 20% âœ“<br>
                â€¢ æœ€å¤§å›æ’¤æ§åˆ¶: 15% âœ“
                </div>
            `;
        }
        
        function testProgressTracking() {
            const resultDiv = document.getElementById('featureTestResults');
            resultDiv.innerHTML = `
                <div class="result success">âœ… è¿›åº¦è¿½è¸ªåŠŸèƒ½éªŒè¯</div>
                <div class="result info">
                â€¢ å®æ—¶è¿›åº¦æ›´æ–° âœ“<br>
                â€¢ çŠ¶æ€ä¿¡æ¯æ˜¾ç¤º âœ“<br>
                â€¢ WebSocketé€šä¿¡ âœ“<br>
                â€¢ é”™è¯¯å¤„ç†æœºåˆ¶ âœ“
                </div>
            `;
        }
        
        function testReportExport() {
            const resultDiv = document.getElementById('featureTestResults');
            
            // æ¨¡æ‹Ÿå¯¼å‡ºåŠŸèƒ½
            const reportData = {
                strategy_name: testStrategy.name,
                backtest_date: new Date().toISOString(),
                results: {
                    total_return: 0.158,
                    max_drawdown: 0.085,
                    sharpe_ratio: 1.25
                }
            };
            
            const dataStr = JSON.stringify(reportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', 'test_backtest_report.json');
            linkElement.click();
            
            resultDiv.innerHTML = `
                <div class="result success">âœ… æŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½éªŒè¯</div>
                <div class="result info">
                â€¢ JSONæ ¼å¼å¯¼å‡º âœ“<br>
                â€¢ å®Œæ•´æ•°æ®ç»“æ„ âœ“<br>
                â€¢ æ–‡ä»¶å‘½åè§„èŒƒ âœ“<br>
                â€¢ æµè§ˆå™¨ä¸‹è½½æ”¯æŒ âœ“
                </div>
            `;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆæç¤º
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… ä¸ªäººç”¨æˆ·å›æµ‹åŠŸèƒ½æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
        });
    </script>
</body>
</html>