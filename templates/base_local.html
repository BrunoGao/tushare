<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}灵境万象 - 股票分析系统{% endblock %}</title>
    
    <!-- 本地化的CSS资源 -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tailwind.min.css') }}">
    
    <!-- 本地化的JavaScript资源 -->
    <script src="{{ url_for('static', filename='js/alpinejs.min.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/echarts.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/lucide.min.js') }}"></script>
    
    <style>
        /* 自定义样式 */
        [x-cloak] { display: none !important; }
        
        /* 渐变样式 */
        .gradient-primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
        }
        .gradient-card { 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); 
        }
        .gradient-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        .gradient-warning {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
        }
        
        /* 图表容器 */
        .chart-container { 
            min-height: 400px; 
            position: relative;
        }
        
        /* 响应式优化 */
        @media (max-width: 768px) {
            .chart-container { min-height: 300px; }
            .mobile-padding { padding: 0.75rem; }
            .mobile-text { font-size: 0.875rem; }
        }
        
        /* 股票涨跌颜色系统 */
        .text-bull { color: #10b981 !important; }
        .text-bear { color: #ef4444 !important; }
        .bg-bull { background-color: #dcfce7 !important; }
        .bg-bear { background-color: #fee2e2 !important; }
        .border-bull { border-color: #10b981 !important; }
        .border-bear { border-color: #ef4444 !important; }
        
        /* 动画效果 */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-slow {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        /* 卡片悬停效果 */
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* 加载状态 */
        .loading {
            position: relative;
            overflow: hidden;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        /* 滚动条美化 */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* 表格美化 */
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .table-striped tbody tr:nth-child(odd) {
            background-color: rgba(0, 0, 0, 0.02);
        }
        
        /* 按钮样式增强 */
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        /* 输入框样式 */
        .input-enhanced {
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
        }
        
        .input-enhanced:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            outline: none;
        }
        
        /* 状态指示器 */
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.5rem;
        }
        
        .status-online { background-color: #10b981; }
        .status-offline { background-color: #ef4444; }
        .status-warning { background-color: #f59e0b; }
        
        /* 数字跳动效果 */
        .number-animate {
            transition: all 0.3s ease;
        }
        
        .number-up {
            color: #10b981;
            animation: bounceUp 0.3s ease;
        }
        
        .number-down {
            color: #ef4444;
            animation: bounceDown 0.3s ease;
        }
        
        @keyframes bounceUp {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-3px); }
            60% { transform: translateY(-1px); }
        }
        
        @keyframes bounceDown {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(3px); }
            60% { transform: translateY(1px); }
        }
    </style>
    
    {% block head %}{% endblock %}
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 导航栏 -->
    <nav class="gradient-primary shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="/" class="flex items-center space-x-2 text-white hover:text-gray-200 transition-colors">
                        <i data-lucide="trending-up" class="h-8 w-8"></i>
                        <span class="font-bold text-xl hidden sm:block">灵境万象</span>
                        <span class="font-bold text-lg sm:hidden">股票分析</span>
                    </a>
                </div>
                
                <!-- 桌面端导航 -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="/" class="nav-link">
                        <i data-lucide="home" class="inline h-4 w-4 mr-1"></i>首页
                    </a>
                    <a href="/analysis" class="nav-link">
                        <i data-lucide="bar-chart-3" class="inline h-4 w-4 mr-1"></i>技术分析
                    </a>
                    <a href="/market-dashboard" class="nav-link">
                        <i data-lucide="dashboard" class="inline h-4 w-4 mr-1"></i>市场仪表板
                    </a>
                    <a href="/intelligent-recommendations" class="nav-link">
                        <i data-lucide="brain" class="inline h-4 w-4 mr-1"></i>智能推荐
                    </a>
                    <a href="/watchlist" class="nav-link">
                        <i data-lucide="bookmark" class="inline h-4 w-4 mr-1"></i>自选股
                    </a>
                    <a href="/signals" class="nav-link">
                        <i data-lucide="bell" class="inline h-4 w-4 mr-1"></i>信号监控
                    </a>
                </div>
                
                <!-- 移动端菜单按钮 -->
                <div class="md:hidden">
                    <button id="mobile-menu-btn" class="text-white hover:text-gray-200 p-2 rounded-md transition-colors">
                        <i data-lucide="menu" class="h-6 w-6"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 移动端菜单 -->
        <div id="mobile-menu" class="hidden md:hidden bg-purple-800 bg-opacity-95">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="/" class="mobile-nav-link">
                    <i data-lucide="home" class="inline h-4 w-4 mr-2"></i>首页
                </a>
                <a href="/analysis" class="mobile-nav-link">
                    <i data-lucide="bar-chart-3" class="inline h-4 w-4 mr-2"></i>技术分析
                </a>
                <a href="/market-dashboard" class="mobile-nav-link">
                    <i data-lucide="dashboard" class="inline h-4 w-4 mr-2"></i>市场仪表板
                </a>
                <a href="/intelligent-recommendations" class="mobile-nav-link">
                    <i data-lucide="brain" class="inline h-4 w-4 mr-2"></i>智能推荐
                </a>
                <a href="/watchlist" class="mobile-nav-link">
                    <i data-lucide="bookmark" class="inline h-4 w-4 mr-2"></i>自选股
                </a>
                <a href="/signals" class="mobile-nav-link">
                    <i data-lucide="bell" class="inline h-4 w-4 mr-2"></i>信号监控
                </a>
            </div>
        </div>
    </nav>
    
    <!-- 主要内容 -->
    <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        {% block content %}{% endblock %}
    </main>
    
    <!-- Toast 通知组件 -->
    <div id="toast-container" class="fixed top-20 right-4 z-50 space-y-2"></div>
    
    <!-- 加载遮罩 -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
        <div class="bg-white rounded-lg p-6 flex items-center space-x-3">
            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600"></div>
            <span class="text-gray-700">加载中...</span>
        </div>
    </div>
    
    <!-- 全局JavaScript -->
    <script>
        // 导航样式
        const navLinkClass = 'text-white hover:text-gray-200 px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200';
        const mobileNavLinkClass = 'text-white hover:bg-purple-700 block px-3 py-2 rounded-md text-base font-medium transition-colors duration-200';
        
        // 为导航链接添加样式
        document.querySelectorAll('.nav-link').forEach(link => {
            link.className = navLinkClass;
        });
        
        document.querySelectorAll('.mobile-nav-link').forEach(link => {
            link.className = mobileNavLinkClass;
        });
        
        // 移动端菜单切换
        document.getElementById('mobile-menu-btn').addEventListener('click', function() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        });
        
        // 点击外部关闭菜单
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('mobile-menu');
            const btn = document.getElementById('mobile-menu-btn');
            
            if (!menu.contains(event.target) && !btn.contains(event.target)) {
                menu.classList.add('hidden');
            }
        });
        
        // Toast通知函数
        function showToast(message, type = 'success', duration = 3000) {
            const toast = document.createElement('div');
            const typeClasses = {
                success: 'bg-green-500 text-white',
                error: 'bg-red-500 text-white',
                warning: 'bg-yellow-500 text-white',
                info: 'bg-blue-500 text-white'
            };
            
            toast.className = `p-4 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full ${typeClasses[type] || typeClasses.info}`;
            toast.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i data-lucide="${type === 'success' ? 'check-circle' : type === 'error' ? 'alert-circle' : 'info'}" class="h-5 w-5"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.getElementById('toast-container').appendChild(toast);
            
            // 初始化图标
            lucide.createIcons();
            
            // 动画显示
            setTimeout(() => toast.classList.remove('translate-x-full'), 100);
            
            // 自动隐藏
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }
        
        // 全局API请求函数
        async function apiRequest(url, options = {}) {
            try {
                showLoading(true);
                const response = await fetch(url, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                if (!response.ok) {
                    throw new Error(`请求失败: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                showLoading(false);
                return data;
                
            } catch (error) {
                showLoading(false);
                showToast(error.message || '请求失败', 'error');
                throw error;
            }
        }
        
        // 显示/隐藏加载遮罩
        function showLoading(show) {
            const overlay = document.getElementById('loading-overlay');
            if (show) {
                overlay.classList.remove('hidden');
                overlay.classList.add('flex');
            } else {
                overlay.classList.add('hidden');
                overlay.classList.remove('flex');
            }
        }
        
        // 格式化数字
        function formatNumber(num, decimals = 2) {
            if (num === null || num === undefined || isNaN(num)) return '--';
            
            const number = Number(num);
            if (Math.abs(number) >= 1e9) {
                return (number / 1e9).toFixed(decimals) + 'B';
            } else if (Math.abs(number) >= 1e6) {
                return (number / 1e6).toFixed(decimals) + 'M';
            } else if (Math.abs(number) >= 1e4) {
                return (number / 1e4).toFixed(decimals) + 'W';
            } else {
                return number.toFixed(decimals);
            }
        }
        
        // 格式化百分比
        function formatPercent(num, decimals = 2) {
            if (num === null || num === undefined || isNaN(num)) return '--';
            const formatted = Number(num).toFixed(decimals);
            return num >= 0 ? `+${formatted}%` : `${formatted}%`;
        }
        
        // 格式化货币
        function formatCurrency(num, decimals = 2) {
            if (num === null || num === undefined || isNaN(num)) return '--';
            return '¥' + formatNumber(num, decimals);
        }
        
        // 获取涨跌颜色类
        function getChangeColorClass(value, prefix = 'text') {
            if (value > 0) return `${prefix}-bull`;
            if (value < 0) return `${prefix}-bear`;
            return `${prefix}-gray-600`;
        }
        
        // 数字动画效果
        function animateNumber(element, newValue, oldValue) {
            if (newValue > oldValue) {
                element.classList.add('number-up');
                setTimeout(() => element.classList.remove('number-up'), 300);
            } else if (newValue < oldValue) {
                element.classList.add('number-down');
                setTimeout(() => element.classList.remove('number-down'), 300);
            }
        }
        
        // 时间格式化
        function formatTime(timestamp) {
            if (!timestamp) return '--';
            const date = new Date(timestamp);
            return date.toLocaleString('zh-CN');
        }
        
        // 防抖函数
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // 节流函数
        function throttle(func, limit) {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化Lucide图标
            lucide.createIcons();
            
            // 添加页面加载动画
            document.body.classList.add('fade-in');
            
            // 高亮当前页面导航
            const currentPath = window.location.pathname;
            document.querySelectorAll('nav a').forEach(link => {
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('bg-purple-700', 'bg-opacity-50');
                }
            });
        });
        
        // 错误处理
        window.addEventListener('error', function(event) {
            console.error('Global error:', event.error);
            showToast('系统出现错误，请刷新页面重试', 'error');
        });
        
        // 网络状态监控
        window.addEventListener('online', () => showToast('网络连接已恢复', 'success'));
        window.addEventListener('offline', () => showToast('网络连接已断开', 'warning'));
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>