<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>WebSocketæµ‹è¯•é¡µé¢</title>
    <style>
        body{font-family:Arial,sans-serif;padding:20px;background:#1a1a1a;color:#fff}
        .container{max-width:800px;margin:0 auto}
        .status{padding:10px;margin:10px 0;border-radius:5px}
        .connected{background:#28a745}.disconnected{background:#dc3545}
        button{padding:10px 20px;margin:5px;border:none;border-radius:5px;cursor:pointer}
        .btn-connect{background:#007bff;color:white}
        .btn-subscribe{background:#28a745;color:white}
        #messages{background:#333;padding:15px;border-radius:5px;height:400px;overflow-y:auto;margin:20px 0}
        .message{margin:5px 0;padding:5px;border-left:3px solid #007bff}
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”Œ WebSocketå®æ—¶è‚¡ç¥¨ç³»ç»Ÿæµ‹è¯•</h1>
        
        <div id="status" class="status disconnected">ğŸ”´ æœªè¿æ¥</div>
        
        <div>
            <button class="btn-connect" onclick="connectWS()">è¿æ¥WebSocket</button>
            <button class="btn-subscribe" onclick="subscribeStock()">è®¢é˜…000001.SZ</button>
            <button onclick="clearMessages()">æ¸…ç©ºæ¶ˆæ¯</button>
        </div>
        
        <div id="messages"></div>
    </div>

    <script>
        let ws=null;
        let isConnected=false;
        
        function updateStatus(text,connected){
            const status=document.getElementById('status');
            status.textContent=text;
            status.className=`status ${connected?'connected':'disconnected'}`;
            isConnected=connected;
        }
        
        function addMessage(msg,type='info'){
            const messages=document.getElementById('messages');
            const div=document.createElement('div');
            div.className='message';
            div.innerHTML=`<strong>${new Date().toLocaleTimeString()}</strong> ${msg}`;
            messages.appendChild(div);
            messages.scrollTop=messages.scrollHeight;
        }
        
        function connectWS(){
            if(ws){
                ws.close();
            }
            
            addMessage('ğŸ”Œ æ­£åœ¨è¿æ¥WebSocketæœåŠ¡å™¨...');
            ws=new WebSocket('ws://localhost:8765');
            
            ws.onopen=()=>{
                updateStatus('ğŸŸ¢ å·²è¿æ¥',true);
                addMessage('âœ… WebSocketè¿æ¥æˆåŠŸ!');
            };
            
            ws.onmessage=(event)=>{
                const data=JSON.parse(event.data);
                addMessage(`ğŸ“¥ æ”¶åˆ°æ¶ˆæ¯: ${data.type}`);
                
                if(data.type==='realtime_data' || data.type==='realtime_update'){
                    const price=data.data.price;
                    addMessage(`ğŸ’° è‚¡ä»·æ•°æ®: å½“å‰ä»·=${price.current} æ¶¨è·Œ=${price.change} æ¶¨è·Œå¹…=${price.change_pct}%`);
                }
            };
            
            ws.onclose=()=>{
                updateStatus('ğŸ”´ è¿æ¥å…³é—­',false);
                addMessage('âŒ WebSocketè¿æ¥å…³é—­');
            };
            
            ws.onerror=(error)=>{
                updateStatus('ğŸ”´ è¿æ¥é”™è¯¯',false);
                addMessage(`âŒ è¿æ¥é”™è¯¯: ${error}`);
            };
        }
        
        function subscribeStock(){
            if(!isConnected){
                addMessage('âš ï¸ è¯·å…ˆè¿æ¥WebSocket');
                return;
            }
            
            const msg={type:'subscribe',code:'000001.SZ'};
            ws.send(JSON.stringify(msg));
            addMessage(`ğŸ“¤ å‘é€è®¢é˜…è¯·æ±‚: ${JSON.stringify(msg)}`);
        }
        
        function clearMessages(){
            document.getElementById('messages').innerHTML='';
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿æ¥
        window.onload=()=>{
            addMessage('ğŸš€ WebSocketæµ‹è¯•é¡µé¢å·²åŠ è½½');
        };
    </script>
</body>
</html> 