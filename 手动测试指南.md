# 🧪 领京万象系统 - 手动测试指南

## 🚀 快速启动

### 方法一：使用优化启动脚本（推荐）
```bash
# 启动完整优化系统
python start_optimized_system.py
```

### 方法二：分步启动
```bash
# 1. 启动API服务
python api/app.py

# 2. 在另一个终端启动系统监控（可选）
python -c "from utils.system_monitor import system_monitor; system_monitor.start_monitoring()"
```

## 📋 测试检查清单

### 1. 系统基础功能测试

#### ✅ API服务测试
```bash
# 测试健康检查接口
curl http://localhost:5000/api/health

# 预期响应：
# {"status": "healthy", "timestamp": "2025-01-29T..."}
```

#### ✅ 系统健康状态测试
```bash
# 测试系统健康接口
curl http://localhost:5000/api/system/health

# 预期响应：包含数据健康、缓存健康、系统状态等信息
```

### 2. 前端界面测试

#### ✅ 访问推荐界面
1. 打开浏览器访问：`http://localhost:5000/frontend/recommendation_dashboard.html`
2. 检查页面是否正常加载
3. 检查界面元素：
   - 头部标题和状态指示器
   - 策略选择按钮（综合推荐、技术面、基本面、资金面、AI预测）
   - 筛选控制面板
   - 推荐结果展示区域

#### ✅ 界面交互测试
1. **策略切换测试**：
   - 点击不同策略按钮，观察按钮状态变化
   - 确认当前选中策略高亮显示

2. **参数调整测试**：
   - 修改推荐数量（10/20/30/50只）
   - 调整最低评分（50/60/70/80分）
   - 选择排序方式

3. **生成推荐测试**：
   - 点击"生成推荐"按钮
   - 观察加载状态显示
   - 等待推荐结果展示

### 3. 多策略推荐引擎测试

#### ✅ 综合推荐测试
```bash
# 使用curl测试推荐接口
curl -X POST http://localhost:5000/api/recommendations/generate \
  -H "Content-Type: application/json" \
  -d '{
    "strategy": "multi_strategy",
    "limit": 10,
    "min_score": 60
  }'
```

#### ✅ 单一策略测试
```bash
# 测试技术面策略
curl -X POST http://localhost:5000/api/recommendations/generate \
  -H "Content-Type: application/json" \
  -d '{
    "strategy": "technical",
    "limit": 5,
    "min_score": 50
  }'
```

### 4. 缓存系统测试

#### ✅ 缓存功能验证
1. **首次请求**：记录响应时间
2. **重复请求**：观察响应时间是否显著减少
3. **缓存统计**：
```bash
# 如果有Redis客户端，可以查看缓存键
redis-cli keys "*rec*"  # 查看推荐缓存
redis-cli keys "*ind*"  # 查看指标缓存
```

### 5. 数据健康检查测试

#### ✅ 手动执行健康检查
```bash
# 运行数据健康检查
python -c "
from utils.data_health_checker import data_health_checker
report = data_health_checker.check_system_health()
print('整体状态:', report['overall_status'])
print('整体评分:', report['overall_score'])
print('检查表数:', len(report['tables']))
"
```

### 6. 系统监控测试

#### ✅ 监控功能验证
```bash
# 获取当前系统状态
python -c "
from utils.system_monitor import system_monitor
status = system_monitor.get_current_status()
print('健康评分:', status['health_score'])
print('系统状态:', status['status'])
"
```

## 🔍 详细测试步骤

### 步骤1：启动系统
```bash
# 在项目根目录执行
python start_optimized_system.py
```

**预期输出**：
```
🚀 启动领京万象优化系统
================================================================================
🔍 执行启动前检查...
✅ 数据库连接正常
✅ Redis缓存连接正常
✅ 启动前检查完成
🔧 启动核心服务...
🏥 数据健康检查器已启动
🔥 开始缓存预热...
✅ 核心服务启动完成
📊 启动监控服务...
📈 系统监控器已启动
✅ 监控服务启动完成
🌐 启动API服务...
🚀 API服务器启动中... (http://localhost:5000)
✅ API服务启动成功
⏰ 启动调度服务...
📅 数据调度器已启动
✅ 调度服务启动完成
🔍 执行启动后检查...
🧪 执行快速系统检查...
✅ 多策略推荐引擎正常
✅ 缓存管理器正常 (命中率: 0%)
✅ 启动后检查完成
✅ 系统启动完成！
================================================================================
🎉 领京万象优化系统已就绪
================================================================================
🕐 启动时间: X.XX秒
🧵 运行线程: X
🌐 API服务: http://localhost:5000
📊 推荐界面: http://localhost:5000/frontend/recommendation_dashboard.html
📈 实时界面: http://localhost:5000/frontend/realtime_dashboard.html
================================================================================
```

### 步骤2：测试前端界面

1. **打开推荐界面**：
   - 访问：`http://localhost:5000/frontend/recommendation_dashboard.html`
   - 检查页面加载是否正常
   - 确认所有样式和布局正确显示

2. **测试策略选择**：
   - 点击"综合推荐"按钮（默认选中）
   - 依次点击"技术面"、"基本面"、"资金面"、"AI预测"
   - 观察按钮状态变化和高亮效果

3. **调整推荐参数**：
   - 推荐数量：选择20只股票
   - 最低评分：选择60分以上
   - 排序方式：按评分排序

4. **生成推荐**：
   - 点击"生成推荐"按钮
   - 观察加载动画显示
   - 等待推荐结果展示（可能需要10-30秒）

### 步骤3：验证推荐结果

**预期结果展示**：
- 推荐卡片网格布局
- 每个卡片包含：
  - 股票代码和名称
  - 推荐类型标签（买入/持有/卖出）
  - 综合评分圆形显示
  - 置信度进度条
  - 策略分解详情
  - 关键信号列表
  - 推荐理由说明

### 步骤4：测试系统功能

1. **刷新数据功能**：
   - 点击"刷新数据"按钮
   - 观察系统状态更新

2. **导出功能**：
   - 生成推荐后，点击"导出结果"按钮
   - 检查CSV文件下载

3. **响应式测试**：
   - 调整浏览器窗口大小
   - 检查界面在不同尺寸下的适配

## 🐛 常见问题排查

### 问题1：API服务启动失败
**症状**：端口5000被占用
**解决**：
```bash
# 查找占用端口的进程
lsof -i :5000
# 或者
netstat -tulpn | grep :5000

# 杀死占用进程
kill -9 <PID>
```

### 问题2：数据库连接失败
**症状**：数据库连接异常
**解决**：
1. 检查MySQL服务是否启动
2. 确认数据库配置正确（config.py）
3. 检查数据库用户权限

### 问题3：Redis连接失败
**症状**：缓存功能异常
**解决**：
1. 启动Redis服务：`redis-server`
2. 检查Redis配置
3. 系统会自动降级到内存缓存

### 问题4：推荐生成失败
**症状**：点击生成推荐后显示错误
**解决**：
1. 检查数据库中是否有股票数据
2. 运行数据初始化：`python scripts/data_initialization.py`
3. 检查API服务日志

### 问题5：前端页面无法访问
**症状**：404错误
**解决**：
1. 确认API服务正常启动
2. 检查文件路径是否正确
3. 直接访问：`http://localhost:5000/`

## 📊 性能测试

### 响应时间测试
```bash
# 测试API响应时间
time curl -X POST http://localhost:5000/api/recommendations/generate \
  -H "Content-Type: application/json" \
  -d '{"strategy": "multi_strategy", "limit": 5, "min_score": 50}'
```

### 并发测试
```bash
# 使用ab工具进行并发测试（如果已安装）
ab -n 100 -c 10 http://localhost:5000/api/health
```

## ✅ 测试完成检查

完成以下检查项，确认系统正常运行：

- [ ] API服务正常启动（端口5000）
- [ ] 前端界面正常加载
- [ ] 策略选择功能正常
- [ ] 推荐生成功能正常
- [ ] 推荐结果正确显示
- [ ] 缓存功能正常工作
- [ ] 系统监控正常运行
- [ ] 数据健康检查正常
- [ ] 响应式设计正常
- [ ] 导出功能正常

## 🎯 测试重点

1. **核心功能**：多策略推荐生成
2. **性能表现**：响应时间和缓存效果
3. **用户体验**：界面交互和数据展示
4. **系统稳定性**：长时间运行和错误处理
5. **数据准确性**：推荐结果的合理性

完成测试后，系统应该能够稳定运行并提供准确的股票推荐服务！

---

*测试指南更新时间: 2025年1月29日*